

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head><meta http-equiv="X-UA-Compatible" content="IE=7" /><meta name="robots" content="index,follow" />
<meta name="description" content="The official NHibernate community site. Download NHibernate. Read blogs. Contribute to the NHibernate Wiki. Find reference documentation." />
<meta name="keywords" content="NHibernate, NHibernate Contrib, community, Burrow, Downloads" />
<meta name="GENERATOR" content="CommunityServer 2008.5 SP1 (Build: 31106.3070)" />
<link rel="shortcut icon" type="image/ico" href="../../favicon.ico" />
<link rel="alternate" type="application/rss+xml" title="Customizing Fluent Nhibernate&#39;s AutoPersistenceModel Conventions (RSS 2.0)" href="customizing-fluent-nhibernate-s-autopersistencemodel-conventions/rss.aspx"  />
<link rel="alternate" type="application/rss+xml" title="How to (RSS 2.0)" href="http://nhforge.org/wikis/howtonh/rss.aspx"  />
<link rel="alternate" type="application/rss+xml" title="Chris Nicola&#39;s Announcements (RSS 2.0)" href="../../members/chnicola/announcements/rss.aspx"  />
<link rel="alternate" type="application/rss+xml" title="Chris Nicola&#39;s Comments (RSS 2.0)" href="../../members/chnicola/comments/rss.aspx"  />
<link rel="alternate" type="application/rss+xml" title="Chris Nicola&#39;s Activities (RSS 2.0)" href="../../members/chnicola/activities/rss.aspx"  />
<link rel="alternate" type="application/rss+xml" title="Chris Nicola&#39;s Friends Activity (RSS 2.0)" href="../../members/chnicola/activities/friendrss.aspx"  />

        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <style type="text/css"> body { font-size: 84%; } </style>
        <link rel="stylesheet" href="../../themes/hawaii/style/Common.css" type="text/css" media="screen,print" />
        <link rel="stylesheet" href="../../themes/hawaii/style/common_print.css" type="text/css" media="print" />
        
    
    <link rel="stylesheet" href="../../Themes/hawaii/style/wiki.css" type="text/css" media="screen,print" />
	

        <link rel="stylesheet" href="../../themes/hawaii/style/DynamicStyle.aspx.css" type="text/css" media="screen" />
        <!--[if lte IE 6]>
            <link rel="stylesheet" href="/themes/hawaii/style/ie6.css" type="text/css" media="screen" />
        <![endif]-->
    <meta name="google-site-verification" content="u9qihpHbzSFdf2ypCUvCQrj9IJkANGzorC8zMk0859M" />
<title>
	Customizing Fluent Nhibernate&#39;s AutoPersistenceModel Conventions - NHibernate Forge
</title></head>
	<body>
		<form name="aspnetForm" method="post" action="customizing-fluent-nhibernate-s-autopersistencemodel-conventions.aspx.html" id="aspnetForm">
<div>
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="/wEPDwULLTE0MjI1NzA4NTBkGAEFHl9fQ29udHJvbHNSZXF1aXJlUG9zdEJhY2tLZXlfXxYBBTBjdGwwMCRjdGwwMCRzciRzciRjdGwwMCRjdGwwMCRUaXRsZUJhclNlYXJjaFRleHRnkoeGkMFUl/GCfp0jWEl0wBWF5g==" />
</div>


<script src="../../WebResource.axd%3Fd=0gbcOAOlbWsHyCtP1tLKZQbpxrEkhg31E8L04T1x-hMLrsMonvmUNQvxBohSywWHueFgWT841lW9e5k7Gp2DbPsOLeN3Sv3SB7czfVSlQGxYOHnJcLlKfh3v9vlcjJ9ggvps0fjahw73J3SVYQmGvS0rXng1&amp;t=634395149500000000" type="text/javascript"></script>
<script src="../../WebResource.axd%3Fd=qXX_qxw7Y60qjc1NsxHnuIWUCy9JxjEUKLrY5KEQyuYhKzv3UmRPH805gTXU5edfSsLl7PHTIDuZbzGOp5UYEWeQ6anyqFa-m5TiNnZiD5MOrgiKWAZBgPyJ267gdCbk0_TpK2BaAhLvEgyM28dt9SYQ2UM1&amp;t=634395149500000000" type="text/javascript"></script>
<script src="../../WebResource.axd%3Fd=c5kkseX-7hUDg441H_iVoy5ws7YKvwS4KliHEKHuRl5UdJkUU5Jbdf2sxzCcbfyn6sqe17DzqhSTfAyV8nyJKMHhScl2IzjSz37RVYryN9Omis3K0NCj_OJ4fHZH3n9_IPBlNLVyYL45kjJL_zhydrkKTi3FfxaImDeS_1JZIO7o9iFs0&amp;t=634395149500000000" type="text/javascript"></script>
<script src="../../WebResource.axd%3Fd=ooIwVX8behGAEmhMCiixHbDdkMUOVYaZRdlMT8IcoNg04bCvP2nwsB6TYoQ7d2Jv_3l4oJ1T22OjM-M-2DunSYiieujBrutwDXLnAl2vCYvC2eq5i-t1eW9X33MvMiQlvp4qyu1-rLPWkjuV_LZnUetgmSNTxQbJe-EddFxbtbp-DYr30&amp;t=634395149500000000" type="text/javascript"></script>
<script src="../../WebResource.axd%3Fd=xXlM6p6Z55_L0aHC_AFQRK0Cjmpbijxk7GNNsmfNwwA1waqkaV-hG1FcycUhTX3miKHBKKxRY86jAc_xya2ioQnh8uEZNMdbhp5EeN7LrycYZRTwA1RkyBpeEDeC_6M7Ye32k1z4nBfateiS4xaRnrrk7zAUyXGK9sqQp9FDULq-nwZx0&amp;t=634395149500000000" type="text/javascript"></script>
<script src="../../WebResource.axd%3Fd=kMYUTUavSIm2PfhqImV65wSrGgvlXLz6y2I9w1Ny3wgQ9Mr8YxqHob4FEFjJCAuSefb7UiiHarHcIuJD4xiKEgAWZ6bkGuLRZKuFDCHjRSswzwvX2HIxCYe1LS8DvrUxi4omY-uxichRl_7QG7gvnymf7ji60ufX0GdWKCPuYuKcXuCoaDwpH8N3g3tlQpPEgpisGg2&amp;t=634395149480000000" type="text/javascript"></script>
						

			

		    
		        <div id="CommonHeader">
		            <div class="Common">
		                <div id="CommonHeaderTitleArea">
		                    <table cellpadding="0" cellspacing="0" border="0"><tr valign="middle">
		                        <td><div style="margin-right: 10px;"><img src="../../cfs-file.ashx/__key/CommunityServer.Components.SiteFiles/logos/LogoNH.gif" alt="" style="border-width:0px;" /></div></td>
		                        <td>
		                            <div class="CommonHeaderTitle">NHibernate Forge</div>
		                            <div class="CommonHeaderTitleDescription">The official new home for the NHibernate for .NET community</div>
		                        </td>
		                    </tr></table>
		                </div>
		                <div id="CommonHeaderUserArea">
		                    <table cellpadding="0" cellspacing="0" border="0"><tr valign="top"><td>
                                <div id="CommonHeaderUserContent">
                                    <div id="CommonHeaderUserWelcome">
                                        
        <a href="../../login.aspx%3FReturnUrl=%252Fwikis%252Fhowtonh%252Fcustomizing-fluent-nhibernate-s-autopersistencemodel-conventions.aspx.html">Sign in </a>
         | <a href="../../user/CreateUser.aspx%3FReturnUrl=.html">Join</a>
        | <a href="http://dev.communityserver.com/r.ashx?K&amp;siteurl=wikis.wiki_Page_View">Help</a>
     


                                    </div>
                                </div>
                            </td></tr></table>
                        </div>
                    </div>
                </div>
                <div id="CommonNavigation">
                    <div class="Common"><div class="Inner">
                        <ul>
                                
                                <li><a href="../../index.html">Home</a></li>
                            
                                
                                <li><a href="../../blogs/nhibernate.html">Blog</a></li>
                            
                                <li><a class="Selected" href="../index.html">Wikis</a></li>
                                
                            
                                
                                <li><a href="../../groups/index.html">Groups</a></li>
                            
                                
                                <li><a href="../../doc/nh/en/index.html">Reference</a></li>
                            
                                
                                <li><a href="http://nhibernate.jira.com">Issue tracker</a></li>
                            
                                
                                <li><a href="https://github.com/nhibernate/nhibernate-core">Source Code</a></li>
                            </ul>
                        <div style="clear: both;"></div>
                     </div></div>
                </div>
                
                        <div id="CommonNavigation2">
                            <div class="Common"><div class="Inner">
                                <ul>
                    
                        
                        <li><a href="../general/default.aspx.html">General</a></li>
                    
                        <li><a class="Selected" href="default.aspx.html">How to</a></li>
                        
                    
                        
                        <li><a href="../patternsandpractices/default.aspx.html">Patterns&Practices</a></li>
                    
                                </ul>
                            </div></div>
                        </div>
                    
                <div id="CommonNavigationShadow">
                    
    
    <div class="CommonBreadCrumbArea"><div class="Common">
        <a href="../index.html">Wikis</a>
        &raquo;
        <a href="default.aspx.html">How to</a>
        &raquo;
        <a href="customizing-fluent-nhibernate-s-autopersistencemodel-conventions.aspx.html">Customizing Fluent Nhibernate&#39;s AutoPersistenceModel Conventions</a>
    </div></div>


                </div>
		    
                        
            <div class="Common">
            
                
            
                <div id="CommonSearch">
                    
    
        
                <div class="CommonSearchArea">
                    <div class="CommonSearchRoundTop"><div class="r1"></div><div class="r2"></div><div class="r3"></div><div class="r4"></div></div>
                    <div class="CommonSearchContent"><div class="CommonSearchContentInner">
                        <input name="ctl00$ctl00$sr$sr$ctl00$ctl00$TitleBarSearchText" type="text" maxlength="64" size="15" id="ctl00_ctl00_sr_sr_ctl00_ctl00_TitleBarSearchText" onclick="if(this.defaultValue==this.value) this.value='';" onblur="if(this.value=='') this.value=this.defaultValue;" onkeydown="return KeyDownHandlerctl00_ctl00_sr_sr_ctl00_ctl00_TitleBarSearchButton(event);" /><input type="submit" name="ctl00$ctl00$sr$sr$ctl00$ctl00$TitleBarSearchButton" value="Â " id="ctl00_ctl00_sr_sr_ctl00_ctl00_TitleBarSearchButton" class="CommonSearchButton" />
                    </div></div>
                    <div class="CommonSearchRoundBottom"><div class="r1"></div><div class="r2"></div><div class="r3"></div><div class="r4"></div></div>
                </div>
            
    

                </div>
                <div id="CommonTitle">
                    
    
    <h1 class="CommonTitle">Customizing Fluent Nhibernate&#39;s AutoPersistenceModel Conventions</h1>


                </div>
                <div style="clear: both;"></div>
			    <div id="CommonSidebarRight">
			        
    
	<div class="CommonSidebar">
	    
	    
	        
	                <div class="CommonContentBox">
                        <h4 class="CommonContentBoxHeader">Shortcuts</h4>
	                    <div class="CommonContentBoxContent">
	            <ul class='CommonSidebarList'><li><a href="default.aspx.html">Home</a></li><li><a href="customizing-fluent-nhibernate-s-autopersistencemodel-conventions/rss.aspx">RSS feed for page</a></li></ul>
				        </div>
				        
			        </div>
	            
	    
	        
	    
	        
	                <div class="CommonContentBox">
                        <h4 class="CommonContentBoxHeader">Wiki Page Hierarchy</h4>
	                    <div class="CommonContentBoxContent">
	            <div><ul class="CommonHierarchicalList"><li><a href="mapping-a-view-and-schema-export-workaround.aspx.html">Mapping a view and Schema Export Workaround</a></li><li><a href="lazy-loading-eager-loading.aspx.html">Lazy loading - eager loading</a></li><li><a href="configure-log4net-for-use-with-nhibernate.aspx.html">Configure Log4Net for use with NHibernate</a></li><li><a href="get-unique-results-from-joined-queries.aspx.html">Get unique results from joined queries</a></li><li><a href="customizing-fluent-nhibernate-s-autopersistencemodel-conventions.aspx.html#" onclick="ctl00_ctl00_rcr_rcr_ctl00_ctl02_ctl00_ctl01_ctl01._expand(30, this); return false;"><img src="../../WebResource.axd%3Fd=sNXLzaCqbYO_a-ZjCZB88HF4WT8YRbuRaD2xfyafsCiRqelSVt4GYH9QzNn_EvXM02V5zpjGwsymzmW30OIrbB4EUeqA1XW4oU6sME2qMEcOgSVpfz1_YK7UdKB8bVtbFiuWJt3UljrDk5OnRzQEWKDyXNGX0R6sJsultQeBjufuUDz-0&amp;t=634395149500000000" alt="+" style="border-width: 0;" /></a><a href="your-first-nhibernate-based-application.aspx.html">Your first NHibernate based application</a></li><li><a href="run-in-medium-trust.aspx.html">Run in Medium Trust</a></li><li><a href="pre-generate-lazy-loading-proxies.aspx.html">Pre-Generate Lazy Loading Proxies</a></li><li><a href="customizing-fluent-nhibernate-s-autopersistencemodel-conventions.aspx.html#" onclick="ctl00_ctl00_rcr_rcr_ctl00_ctl02_ctl00_ctl01_ctl01._expand(42, this); return false;"><img src="../../WebResource.axd%3Fd=sNXLzaCqbYO_a-ZjCZB88HF4WT8YRbuRaD2xfyafsCiRqelSVt4GYH9QzNn_EvXM02V5zpjGwsymzmW30OIrbB4EUeqA1XW4oU6sME2qMEcOgSVpfz1_YK7UdKB8bVtbFiuWJt3UljrDk5OnRzQEWKDyXNGX0R6sJsultQeBjufuUDz-0&amp;t=634395149500000000" alt="+" style="border-width: 0;" /></a><a href="using-user-types.aspx.html">Using User Types</a></li><li><a href="lazy-loaded-one-to-one-with-nhibernate.aspx.html">Lazy Loaded One-To-One With NHibernate </a></li><li><a href="dynamically-change-user-info-in-connection-string.aspx.html">Dynamically change user info in connection string</a></li><li><a href="contextual-data-using-nhibernate-filters.aspx.html">Contextual data using NHibernate filters</a></li><li><a href="mapping-the-same-class-to-a-view-and-a-table-using-entity-name.aspx.html">Mapping the same class to a view and a table using entity-name</a></li><li><a href="creating-an-audit-log-using-nhibernate-events.aspx.html">Creating an Audit Log using NHibernate Events</a></li><li><a href="customizing-fluent-nhibernate-s-autopersistencemodel-conventions.aspx.html#" onclick="ctl00_ctl00_rcr_rcr_ctl00_ctl02_ctl00_ctl01_ctl01._expand(51, this); return false;"><img src="../../WebResource.axd%3Fd=sNXLzaCqbYO_a-ZjCZB88HF4WT8YRbuRaD2xfyafsCiRqelSVt4GYH9QzNn_EvXM02V5zpjGwsymzmW30OIrbB4EUeqA1XW4oU6sME2qMEcOgSVpfz1_YK7UdKB8bVtbFiuWJt3UljrDk5OnRzQEWKDyXNGX0R6sJsultQeBjufuUDz-0&amp;t=634395149500000000" alt="+" style="border-width: 0;" /></a><a href="create-a-custom-message-interpolator-for-nhibernate-validator.aspx.html">Create a custom message interpolator for NHibernate Validator</a></li><li><a href="use-postgresql-arrays-with-nhibernate.aspx.html">Use PostgreSQL Arrays with NHibernate</a></li><li><a href="retrieve-a-nested-component-with-criteria-api.aspx.html">Retrieve a nested component with Criteria API</a></li><li><a href="tuning-queries-with-ms-sqlserver.aspx.html">Tuning queries with MS SQLServer</a></li><li><a href="nhibernate-concurrency-with-oracle-s-ora-rowscn.aspx.html">NHibernate concurrency with Oracle&#39;s ORA_ROWSCN</a></li><li><a href="the-best-way-to-get-nhibernate-community-support-submit-precise-description-of-the-problem.aspx.html">The best way to get NHibernate community support ? Submit precise description of the problem</a></li><li><a href="simple-audit-metadata-and-logical-deletion-of-business-entities.aspx.html">Simple audit metadata and logical deletion of business entities</a></li><li><a href="prefent-nhibernate-from-saving-default-relations.aspx.html">Prefent NHibernate from saving default relations</a></li><li><a href="creating-a-custom-id-generator-for-nhibernate.aspx.html">Creating a custom id generator for nHibernate</a></li><li><a href="customizing-fluent-nhibernate-s-autopersistencemodel-conventions.aspx.html#" onclick="ctl00_ctl00_rcr_rcr_ctl00_ctl02_ctl00_ctl01_ctl01._expand(66, this); return false;"><img src="../../WebResource.axd%3Fd=sNXLzaCqbYO_a-ZjCZB88HF4WT8YRbuRaD2xfyafsCiRqelSVt4GYH9QzNn_EvXM02V5zpjGwsymzmW30OIrbB4EUeqA1XW4oU6sME2qMEcOgSVpfz1_YK7UdKB8bVtbFiuWJt3UljrDk5OnRzQEWKDyXNGX0R6sJsultQeBjufuUDz-0&amp;t=634395149500000000" alt="+" style="border-width: 0;" /></a><a href="finding-dirty-properties-in-nhibernate.aspx.html">Finding Dirty Properties in NHibernate</a></li><li><a href="currentsessioncontext-for-desktop-development.aspx.html">CurrentSessionContext for Desktop development</a></li><li><a href="customizing-fluent-nhibernate-s-autopersistencemodel-conventions.aspx.html" class="Selected">Customizing Fluent Nhibernate&#39;s AutoPersistenceModel Conventions</a></li><li><a href="how-to-use-db2hbm.aspx.html">How to use Db2hbm</a></li><li><a href="localization-techniques.aspx.html">Localization techniques</a></li><li><a href="calling-oracle-procedure-inside-package.aspx.html">Calling Oracle Procedure inside package</a></li><li><a href="how-to-get-help-with-nhibernate.aspx.html">How To Get Help with NHibernate</a></li><li><a href="nhibernate-features.aspx.html">NHibernate Features</a></li><li><a href="using-nlog-via-common-logging-with-nhibernate.aspx.html">Using NLog via Common.Logging with NHibernate</a></li><li><a href="keeping-entity-state-over-multiple-nhibernate-sessions.aspx.html">Keeping Entity State Over Multiple NHibernate Sessions</a></li><li><a href="enumerating-first-level-cache-entities.aspx.html">Enumerating First Level Cache Entities</a></li><li><a href="hilo-generator-with-node-suffix.aspx.html">HiLo Generator With Node Suffix</a></li><li><a href="nhibernate-audit-trails-and-onpreinsert-onpreupdate-event-listeners-vs-save-update-event-listeners.aspx.html">Changing Values in NHibernate Events</a></li><li><a href="conventionmodelmapper-amp-net-4-iset-lt-gt.aspx.html">ConventionModelMapper &amp; .net 4 ISet&lt;&gt;</a></li><li><a href="conventionmodelmapper-change-manytoone-column-name.aspx.html">ConventionModelMapper - change ManyToOne column name</a></li><li><a href="view-the-xml-generated-when-mapping-by-code.aspx.html">View the xml generated when mapping by code</a></li><li><a href="net-type-generation-for-nhibernate-mapping-collections.aspx.html">.NET type generation for NHibernate mapping collections</a></li><li><a href="a-fully-working-skeleton-for-sexy-loquacious-nh.aspx.html">A fully working skeleton for sexy Loquacious NH</a></li><li><a href="checking-if-an-unloaded-collection-contains-elements.aspx.html">Checking if an Unloaded Collection Contains Elements</a></li><li><a href="mapping-tables.aspx.html">Mapping tables</a></li><li><a href="wcf-nhibernate-entity-serialization.aspx.html">WCF + NHibernate: Entity Serialization</a></li></ul></div>
				        </div>
				        
			        </div>
	            
	    
	        
	                <div class="CommonContentBox">
                        <h4 class="CommonContentBoxHeader">Pages</h4>
	                    <div class="CommonContentBoxContent">
	            <div><ul class="CommonHierarchicalList"><li><a href="mapping-a-view-and-schema-export-workaround.aspx.html">Mapping a view and Schema Export Workaround</a></li><li><a href="lazy-loading-eager-loading.aspx.html">Lazy loading - eager loading</a></li><li><a href="configure-log4net-for-use-with-nhibernate.aspx.html">Configure Log4Net for use with NHibernate</a></li><li><a href="get-unique-results-from-joined-queries.aspx.html">Get unique results from joined queries</a></li><li><a href="customizing-fluent-nhibernate-s-autopersistencemodel-conventions.aspx.html#" onclick="ctl00_ctl00_rcr_rcr_ctl00_ctl03_ctl00_ctl01_ctl01._expand(30, this); return false;"><img src="../../WebResource.axd%3Fd=sNXLzaCqbYO_a-ZjCZB88HF4WT8YRbuRaD2xfyafsCiRqelSVt4GYH9QzNn_EvXM02V5zpjGwsymzmW30OIrbB4EUeqA1XW4oU6sME2qMEcOgSVpfz1_YK7UdKB8bVtbFiuWJt3UljrDk5OnRzQEWKDyXNGX0R6sJsultQeBjufuUDz-0&amp;t=634395149500000000" alt="+" style="border-width: 0;" /></a><a href="your-first-nhibernate-based-application.aspx.html">Your first NHibernate based application</a></li><li><a href="run-in-medium-trust.aspx.html">Run in Medium Trust</a></li><li><a href="pre-generate-lazy-loading-proxies.aspx.html">Pre-Generate Lazy Loading Proxies</a></li><li><a href="customizing-fluent-nhibernate-s-autopersistencemodel-conventions.aspx.html#" onclick="ctl00_ctl00_rcr_rcr_ctl00_ctl03_ctl00_ctl01_ctl01._expand(42, this); return false;"><img src="../../WebResource.axd%3Fd=sNXLzaCqbYO_a-ZjCZB88HF4WT8YRbuRaD2xfyafsCiRqelSVt4GYH9QzNn_EvXM02V5zpjGwsymzmW30OIrbB4EUeqA1XW4oU6sME2qMEcOgSVpfz1_YK7UdKB8bVtbFiuWJt3UljrDk5OnRzQEWKDyXNGX0R6sJsultQeBjufuUDz-0&amp;t=634395149500000000" alt="+" style="border-width: 0;" /></a><a href="using-user-types.aspx.html">Using User Types</a></li><li><a href="lazy-loaded-one-to-one-with-nhibernate.aspx.html">Lazy Loaded One-To-One With NHibernate </a></li><li><a href="dynamically-change-user-info-in-connection-string.aspx.html">Dynamically change user info in connection string</a></li><li><a href="contextual-data-using-nhibernate-filters.aspx.html">Contextual data using NHibernate filters</a></li><li><a href="mapping-the-same-class-to-a-view-and-a-table-using-entity-name.aspx.html">Mapping the same class to a view and a table using entity-name</a></li><li><a href="creating-an-audit-log-using-nhibernate-events.aspx.html">Creating an Audit Log using NHibernate Events</a></li><li><a href="customizing-fluent-nhibernate-s-autopersistencemodel-conventions.aspx.html#" onclick="ctl00_ctl00_rcr_rcr_ctl00_ctl03_ctl00_ctl01_ctl01._expand(51, this); return false;"><img src="../../WebResource.axd%3Fd=sNXLzaCqbYO_a-ZjCZB88HF4WT8YRbuRaD2xfyafsCiRqelSVt4GYH9QzNn_EvXM02V5zpjGwsymzmW30OIrbB4EUeqA1XW4oU6sME2qMEcOgSVpfz1_YK7UdKB8bVtbFiuWJt3UljrDk5OnRzQEWKDyXNGX0R6sJsultQeBjufuUDz-0&amp;t=634395149500000000" alt="+" style="border-width: 0;" /></a><a href="create-a-custom-message-interpolator-for-nhibernate-validator.aspx.html">Create a custom message interpolator for NHibernate Validator</a></li><li><a href="use-postgresql-arrays-with-nhibernate.aspx.html">Use PostgreSQL Arrays with NHibernate</a></li><li><a href="retrieve-a-nested-component-with-criteria-api.aspx.html">Retrieve a nested component with Criteria API</a></li><li><a href="tuning-queries-with-ms-sqlserver.aspx.html">Tuning queries with MS SQLServer</a></li><li><a href="nhibernate-concurrency-with-oracle-s-ora-rowscn.aspx.html">NHibernate concurrency with Oracle&#39;s ORA_ROWSCN</a></li><li><a href="the-best-way-to-get-nhibernate-community-support-submit-precise-description-of-the-problem.aspx.html">The best way to get NHibernate community support ? Submit precise description of the problem</a></li><li><a href="simple-audit-metadata-and-logical-deletion-of-business-entities.aspx.html">Simple audit metadata and logical deletion of business entities</a></li><li><a href="prefent-nhibernate-from-saving-default-relations.aspx.html">Prefent NHibernate from saving default relations</a></li><li><a href="creating-a-custom-id-generator-for-nhibernate.aspx.html">Creating a custom id generator for nHibernate</a></li><li><a href="customizing-fluent-nhibernate-s-autopersistencemodel-conventions.aspx.html#" onclick="ctl00_ctl00_rcr_rcr_ctl00_ctl03_ctl00_ctl01_ctl01._expand(66, this); return false;"><img src="../../WebResource.axd%3Fd=sNXLzaCqbYO_a-ZjCZB88HF4WT8YRbuRaD2xfyafsCiRqelSVt4GYH9QzNn_EvXM02V5zpjGwsymzmW30OIrbB4EUeqA1XW4oU6sME2qMEcOgSVpfz1_YK7UdKB8bVtbFiuWJt3UljrDk5OnRzQEWKDyXNGX0R6sJsultQeBjufuUDz-0&amp;t=634395149500000000" alt="+" style="border-width: 0;" /></a><a href="finding-dirty-properties-in-nhibernate.aspx.html">Finding Dirty Properties in NHibernate</a></li><li><a href="currentsessioncontext-for-desktop-development.aspx.html">CurrentSessionContext for Desktop development</a></li><li><a href="customizing-fluent-nhibernate-s-autopersistencemodel-conventions.aspx.html" class="Selected">Customizing Fluent Nhibernate&#39;s AutoPersistenceModel Conventions</a></li><li><a href="how-to-use-db2hbm.aspx.html">How to use Db2hbm</a></li><li><a href="localization-techniques.aspx.html">Localization techniques</a></li><li><a href="calling-oracle-procedure-inside-package.aspx.html">Calling Oracle Procedure inside package</a></li><li><a href="how-to-get-help-with-nhibernate.aspx.html">How To Get Help with NHibernate</a></li><li><a href="nhibernate-features.aspx.html">NHibernate Features</a></li><li><a href="using-nlog-via-common-logging-with-nhibernate.aspx.html">Using NLog via Common.Logging with NHibernate</a></li><li><a href="keeping-entity-state-over-multiple-nhibernate-sessions.aspx.html">Keeping Entity State Over Multiple NHibernate Sessions</a></li><li><a href="enumerating-first-level-cache-entities.aspx.html">Enumerating First Level Cache Entities</a></li><li><a href="hilo-generator-with-node-suffix.aspx.html">HiLo Generator With Node Suffix</a></li><li><a href="nhibernate-audit-trails-and-onpreinsert-onpreupdate-event-listeners-vs-save-update-event-listeners.aspx.html">Changing Values in NHibernate Events</a></li><li><a href="conventionmodelmapper-amp-net-4-iset-lt-gt.aspx.html">ConventionModelMapper &amp; .net 4 ISet&lt;&gt;</a></li><li><a href="conventionmodelmapper-change-manytoone-column-name.aspx.html">ConventionModelMapper - change ManyToOne column name</a></li><li><a href="view-the-xml-generated-when-mapping-by-code.aspx.html">View the xml generated when mapping by code</a></li><li><a href="net-type-generation-for-nhibernate-mapping-collections.aspx.html">.NET type generation for NHibernate mapping collections</a></li><li><a href="a-fully-working-skeleton-for-sexy-loquacious-nh.aspx.html">A fully working skeleton for sexy Loquacious NH</a></li><li><a href="checking-if-an-unloaded-collection-contains-elements.aspx.html">Checking if an Unloaded Collection Contains Elements</a></li><li><a href="mapping-tables.aspx.html">Mapping tables</a></li><li><a href="wcf-nhibernate-entity-serialization.aspx.html">WCF + NHibernate: Entity Serialization</a></li></ul></div>
				        </div>
				        
			        </div>
	            
	    
	        
	                <div class="CommonContentBox">
                        <h4 class="CommonContentBoxHeader">Tags</h4>
	                    <div class="CommonContentBoxContent">
	            <ul class="CommonSidebarTagCloud">
<li class="CommonTag6"><a href="tags/equality/default.aspx.html" rel="tag">equality</a></li>
<li class="CommonTag6"><a href="tags/identity/default.aspx.html" rel="tag">identity</a></li>
<li class="CommonTag1"><a href="tags/pattern/default.aspx.html" rel="tag">pattern</a></li>
<li class="CommonTag6"><a href="tags/unit+of+work/default.aspx.html" rel="tag">unit of work</a></li>
</ul>

				        </div>
				        <div class="CommonContentBoxFooter"><a href="tags/default.aspx.html">View more</a></div>
			        </div>
	            
	    
	        
	                <div class="CommonContentBox">
                        <h4 class="CommonContentBoxHeader">Page Details</h4>
	                    <div class="CommonContentBoxContent">
	            <div class="CustomWikiPageDetailsArea"><div class="CustomWikiPageDetailsTitle">First published by:</div><div class="CustomWikiPageDetailsAvatar"><img src="../../resized-image.ashx/__size/50x50/__key/CommunityServer.Components.Avatars/00.00.00.26.62/4TDB5C9OI7XU.png" alt="" style="border-width:0px;" /></div><div class="CustomWikiPageDetailsContent"><a href="../../members/chnicola/default.aspx.html">Chris Nicola</a><br/> on 12-24-2009</div></div><div class="CustomWikiPageDetailsArea"><div class="CustomWikiPageDetailsTitle">Last revision by:</div><div class="CustomWikiPageDetailsAvatar"><img src="../../resized-image.ashx/__size/50x50/__key/CommunityServer.Components.Avatars/00.00.00.26.62/4TDB5C9OI7XU.png" alt="" style="border-width:0px;" /></div><div class="CustomWikiPageDetailsContent"><a href="../../members/chnicola/default.aspx.html">Chris Nicola</a><br/> on 12-25-2009</div></div><div class="WikiPageDetailsSummaryArea">This page has not yet been rated</div>
				        </div>
				        
			        </div>
	            
	    
	    
	    
    </div>
    

			    </div>
                <div id="CommonSidebarLeft">
				    
				</div>
			    <div id="CommonContent"><div id="CommonContentInner">
    



<div class="CommonContentBox">
    <div class="CommonContentBoxContent">
        <div style="float: right">
            
        </div>
        
        <div class="CommonPaneTabSet">
            <div style="overflow: hidden;">
                <table border="0" cellpadding="0" cellspacing="0">
                <tbody>
                    <tr>
                        <td>
                            <div class="CommonPaneTabSelected">
                                <img align="absmiddle" border="0" src="../../Themes/hawaii/images/wiki/wiki-icon-article-tab.png" alt="" style="border-width:0px;" /> Article
                            </div>
                        </td>
                        
                                
                                                            
                        <td>
                            <div class="CommonPaneTab">
                                <a href="customizing-fluent-nhibernate-s-autopersistencemodel-conventions/comments.aspx.html"><img align="absmiddle" border="0" src="../../Themes/hawaii/images/wiki/wiki-icon-comment-tab.png" alt="" style="border-width:0px;" /></a>
                                <a href="customizing-fluent-nhibernate-s-autopersistencemodel-conventions/comments.aspx.html">Comments</a> (4)
                            </div>
                        </td>
                        <td>
                            <div class="CommonPaneTab">
                                <a href="customizing-fluent-nhibernate-s-autopersistencemodel-conventions/history.aspx.html"><img align="absmiddle" border="0" src="../../Themes/hawaii/images/wiki/wiki-icon-history-tab.png" alt="" style="border-width:0px;" /></a>
                                <a href="customizing-fluent-nhibernate-s-autopersistencemodel-conventions/history.aspx.html">History</a> (3)
                            </div>
                        </td>
                    </tr>
                </tbody>
                </table>
            </div>
        </div>

        <div class="CommonPane">
            <div class="CommonGroupedContentArea">                

                

                <h2 class="CommonContentBoxHeaderSmall">
                        <span><a href="customizing-fluent-nhibernate-s-autopersistencemodel-conventions.aspx.html">Customizing Fluent Nhibernate&#39;s AutoPersistenceModel Conventions</a></span>
                        
                    </h2>
                                
                <div class="CommonDescription" style="font-size: 90%;">
                    <span id="ctl00_ctl00_bcr_bcr_ctl09_ctl01">Filed under: <a href="tags/AutoPersistenceModel/default.aspx.html" rel="tag">AutoPersistenceModel</a>, <a href="tags/convention+over+configuration/default.aspx.html" rel="tag">convention over configuration</a>, <a href="tags/FluentNH/default.aspx.html" rel="tag">FluentNH</a>, <a href="tags/Mapping/default.aspx.html" rel="tag">Mapping</a></span><input type="hidden" name="ctl00$ctl00$bcr$bcr$ctl09$ctl01" id="ctl00_ctl00_bcr_bcr_ctl09_ctl01_State" value="nochange" /> <a onclick="ctl00_ctl00_bcr_bcr_ctl09_ctl01.Edit(new Function('tags','successFunction','failureFunction','WebForm_DoCallback(\'ctl00$ctl00$bcr$bcr$ctl09\',\'saveAndFormat:\' + tags,successFunction,tags,failureFunction,false)'));return false;" href="customizing-fluent-nhibernate-s-autopersistencemodel-conventions.aspx.html#">[Edit Tags]</a>
                </div>
                <div><p><a href="http://www.lucisferre.net/image.axd?picture=xmlschool_1.jpg"><img style="border-bottom:0px;border-left:0px;margin:0px 6px 0px 0px;display:inline;border-top:0px;border-right:0px;" title="xmlschool" src="http://www.lucisferre.net/image.axd?picture=xmlschool_thumb.jpg" alt="xmlschool" align="left" border="0" width="184" height="244" /></a></p>
<p>(this was originally blogged about <a href="http://www.lucisferre.net/post.aspx?id=0c0eb379-f939-406b-bfb9-a1130a5be664">here</a>) </p>
<p>One of the things I get a fair bit of use out of is the fluent nHibernate project and the AutoPersistenceModel.&nbsp; If you are not very familiar with fluentNH or AutoPersistenceModel then I would suggest checking out their <a href="http://wiki.fluentnhibernate.org/Main_Page">wiki</a>, as what I am about to discuss, while not difficult, is some relatively advanced usage.</p>
<p>The purpose of AutoPersistenceModel is to automatically generate the nHibernate configuration (the HBM files if you are currently used to XML configuration) directly from your model based on Convention over Configuration, <a href="http://www.jameskovacs.com/blog/NETRocks475JamesKovacsOnConventionoverConfiguration.aspx">you can hear James Kovacs discuss this concept on .NET Rocks</a>.&nbsp; With tools like SchemaExport and SchemaUpdate it is even possible to automatically generate and execute DDL scripts against your database to keep the schema in sync with your model.&nbsp; This can be a bit rails like in it&#39;s use, in fact <a href="http://adventuresinagile.blogspot.com/">Adam Dymitruk</a> is currently working on a utility to extend the SchemaUpdate to allow the creation of versioned database scripts like rails has (ok Adam it&#39;s official, now you actually <i>have</i> <i>to </i>finish it!).</p>
<p>The default AutoPersistenceModel conventions are kept quite simple, so often you will need to do a bit of customization.&nbsp; One way to do this is through overrides which I showed how to use in <a href="http://www.lucisferre.net/post.aspx?id=1734653d-6df8-4aa8-8aef-c264406ced37">this post</a>, were I implemented an override for a self-referencing tree relationship.&nbsp; However, whenever possible, it is preferable to use fluentNH&#39;s conventions to do this.&nbsp; Conventions can be used define custom behavior in very flexible ways.&nbsp; Below I am going to show how this can be done to customize database constraints like <i>unique </i>and <i>index</i>. [more]</p>
<p>S#arp Architecture provides a <a href="http://wiki.sharparchitecture.net/Tutorial2DevDomainModel.ashx">[DomainSignature] attribute</a> which you can apply to your entity&#39;s properties.&nbsp;&nbsp; The attribute is used to denote the set of properties that uniquely define the entity and is similar to the concept of a <i>business key</i> often used in SQL database design.&nbsp; It is important to point out that the <i>DomainSignature should</i>&nbsp;<i>not be considered a primary key </i>and that you should <i>always use a surrogate primary key</i> generated either by the database or nHibernate (hilo and guid.comb are the two I prefer).</p>
<p>The domain signature can ensures that entities can be compared using the properties decorated with [DomainSignature].&nbsp; This is useful if say one object was loaded from the repository using nHibernate but another was constructed and I want to determine if I should treat them as the same entity.&nbsp; It is also useful to determine if a new entity will violate a uniqueness constraint you want to enforce.</p>
<p>A good example of a useful DomainSignature would be the slug of a blog post.&nbsp; A post also has an <i>id </i>for it&#39;s primary key<i>,</i> in most cases a guid, but the slug also uniquely identifies a post as well and no two posts can have the same slug.&nbsp; The only problem now is that when I generate my DDL I can see that nHibernate has no notion that it should enforce my uniqueness constraint.</p>
<p>What I want is for nHibernate and hence the database schema should be aware that DomainSignature implies a uniqueness constraint.&nbsp; Fortunately, fluent nHibernate conventions make this is quite easy.&nbsp; Fluent nHibernate defines an <i>AttributePropertyConvention&lt;T&gt;</i> base class for exactly this purpose and we can extend it like this:</p>
<div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:5cfc2d16-0a65-4872-b026-c82df251e9a3" class="wlWriterEditableSmartContent" style="padding-bottom:0px;margin:0px;padding-left:0px;padding-right:0px;display:inline;float:none;padding-top:0px;">
<div style="border:#000080 1px solid;color:#000;font-family:&#39;Courier New&#39;, Courier, Monospace;font-size:10pt;">
<div style="background:#fff;max-height:300px;overflow:auto;"><ol style="background:#ffffff;margin:0;padding:0 0 0 5px;">
<li><span style="color:#0000ff;">public</span> <span style="color:#0000ff;">class</span> <span style="color:#2b91af;">DomainSignatureConvention</span> : <span style="color:#2b91af;">AttributePropertyConvention</span>&lt;<span style="color:#2b91af;">DomainSignatureAttribute</span>&gt; {</li>
<li style="background:#f3f3f3;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">protected</span> <span style="color:#0000ff;">override</span> <span style="color:#0000ff;">void</span> Apply(<span style="color:#2b91af;">DomainSignatureAttribute</span> attribute, <span style="color:#2b91af;">IPropertyInstance</span> instance) { </li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;instance.UniqueKey(instance.EntityType.Name + <span style="color:#a31515;">&quot;DomainSignature&quot;</span>);&nbsp;&nbsp;&nbsp;&nbsp;</li>
<li style="background:#f3f3f3;">&nbsp;&nbsp;&nbsp;&nbsp;}</li>
<li>}</li>
</ol></div>
</div>
</div>
<p>The DomainSignatureConvention tells fluent that all properties that are decorated with [DomainSignature] should form a unique key.&nbsp; Now if I then define my entity like this:</p>
<div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:d54e305c-c2cc-4f98-a45c-8a3cb5f7b64a" class="wlWriterEditableSmartContent" style="padding-bottom:0px;margin:0px;padding-left:0px;padding-right:0px;display:inline;float:none;padding-top:0px;">
<div style="border:#000080 1px solid;color:#000;font-family:&#39;Courier New&#39;, Courier, Monospace;font-size:10pt;">
<div style="background:#fff;max-height:300px;overflow:auto;"><ol style="background:#ffffff;margin:0;padding:0 0 0 5px;">
<li><span style="color:#0000ff;">public</span> <span style="color:#0000ff;">class</span> <span style="color:#2b91af;">Price</span> : <span style="color:#2b91af;">Entity</span> {</li>
<li style="background:#f3f3f3;">&nbsp;&nbsp;&nbsp;&nbsp;[<span style="color:#2b91af;">DomainSignature</span>]</li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">public</span> <span style="color:#0000ff;">virtual</span> <span style="color:#2b91af;">Security</span> Security { <span style="color:#0000ff;">get</span>; <span style="color:#0000ff;">set</span>; }</li>
<li style="background:#f3f3f3;">&nbsp;&nbsp;&nbsp;&nbsp;[<span style="color:#2b91af;">DomainSignature</span>]</li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">public</span> <span style="color:#0000ff;">virtual</span> <span style="color:#2b91af;">DateTime</span> PriceDate { <span style="color:#0000ff;">get</span>; <span style="color:#0000ff;">set</span>; }</li>
<li style="background:#f3f3f3;">&nbsp;&nbsp;&nbsp;&nbsp;[<span style="color:#2b91af;">DomainSignature</span>]</li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">public</span> <span style="color:#0000ff;">virtual</span> <span style="color:#0000ff;">bool</span> CanadianPrice { <span style="color:#0000ff;">get</span>; <span style="color:#0000ff;">set</span>; }</li>
<li style="background:#f3f3f3;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">public</span> <span style="color:#0000ff;">virtual</span> <span style="color:#0000ff;">decimal</span> Bid { <span style="color:#0000ff;">get</span>; <span style="color:#0000ff;">set</span>; }</li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">public</span> <span style="color:#0000ff;">virtual</span> <span style="color:#0000ff;">decimal</span> Ask { <span style="color:#0000ff;">get</span>; <span style="color:#0000ff;">set</span>; }</li>
<li style="background:#f3f3f3;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">public</span> <span style="color:#0000ff;">virtual</span> <span style="color:#0000ff;">decimal</span> Close { <span style="color:#0000ff;">get</span>; <span style="color:#0000ff;">set</span>; }</li>
<li>}</li>
</ol></div>
</div>
</div>
<p>&nbsp;</p>
<p>then SchemaExport will generate DDL like this:</p>
<div id="codeSnippetWrapper">
<div id="codeSnippet" style="border-style:none;padding:0px;overflow:visible;text-align:left;line-height:12pt;background-color:#f4f4f4;width:100%;font-family:&#39;Courier New&#39;,courier,monospace;direction:ltr;color:black;font-size:8pt;">
<pre style="border-style:none;margin:0em;padding:0px;overflow:visible;text-align:left;line-height:12pt;background-color:white;width:100%;font-family:&#39;Courier New&#39;,courier,monospace;direction:ltr;color:black;font-size:8pt;"><span style="color:#0000ff;">create</span> <span style="color:#0000ff;">table</span> Prices (</pre>
<pre style="border-style:none;margin:0em;padding:0px;overflow:visible;text-align:left;line-height:12pt;background-color:#f4f4f4;width:100%;font-family:&#39;Courier New&#39;,courier,monospace;direction:ltr;color:black;font-size:8pt;">    Id <span style="color:#0000ff;">INTEGER</span> <span style="color:#0000ff;">not</span> <span style="color:#0000ff;">null</span>,</pre>
<pre style="border-style:none;margin:0em;padding:0px;overflow:visible;text-align:left;line-height:12pt;background-color:white;width:100%;font-family:&#39;Courier New&#39;,courier,monospace;direction:ltr;color:black;font-size:8pt;">   PriceDate DATETIME,</pre>
<pre style="border-style:none;margin:0em;padding:0px;overflow:visible;text-align:left;line-height:12pt;background-color:#f4f4f4;width:100%;font-family:&#39;Courier New&#39;,courier,monospace;direction:ltr;color:black;font-size:8pt;">   CanadianPrice <span style="color:#0000ff;">INTEGER</span>,</pre>
<pre style="border-style:none;margin:0em;padding:0px;overflow:visible;text-align:left;line-height:12pt;background-color:white;width:100%;font-family:&#39;Courier New&#39;,courier,monospace;direction:ltr;color:black;font-size:8pt;">   Bid <span style="color:#0000ff;">NUMERIC</span>,</pre>
<pre style="border-style:none;margin:0em;padding:0px;overflow:visible;text-align:left;line-height:12pt;background-color:#f4f4f4;width:100%;font-family:&#39;Courier New&#39;,courier,monospace;direction:ltr;color:black;font-size:8pt;">   Ask <span style="color:#0000ff;">NUMERIC</span>,</pre>
<pre style="border-style:none;margin:0em;padding:0px;overflow:visible;text-align:left;line-height:12pt;background-color:white;width:100%;font-family:&#39;Courier New&#39;,courier,monospace;direction:ltr;color:black;font-size:8pt;">   <span style="color:#0000ff;">Close</span> <span style="color:#0000ff;">NUMERIC</span>,</pre>
<pre style="border-style:none;margin:0em;padding:0px;overflow:visible;text-align:left;line-height:12pt;background-color:#f4f4f4;width:100%;font-family:&#39;Courier New&#39;,courier,monospace;direction:ltr;color:black;font-size:8pt;">   SecurityFk <span style="color:#0000ff;">INTEGER</span>,</pre>
<pre style="border-style:none;margin:0em;padding:0px;overflow:visible;text-align:left;line-height:12pt;background-color:white;width:100%;font-family:&#39;Courier New&#39;,courier,monospace;direction:ltr;color:black;font-size:8pt;">   <span style="color:#0000ff;">primary</span> <span style="color:#0000ff;">key</span> (Id),</pre>
<pre style="border-style:none;margin:0em;padding:0px;overflow:visible;text-align:left;line-height:12pt;background-color:#f4f4f4;width:100%;font-family:&#39;Courier New&#39;,courier,monospace;direction:ltr;color:black;font-size:8pt;">  <span style="color:#0000ff;">unique</span> (PriceDate, CanadianPrice)</pre>
<pre style="border-style:none;margin:0em;padding:0px;overflow:visible;text-align:left;line-height:12pt;background-color:white;width:100%;font-family:&#39;Courier New&#39;,courier,monospace;direction:ltr;color:black;font-size:8pt;">)</pre>
</div>
</div>
<p>Except we have a small problem here.&nbsp; The foreign key for the many-to-one relationship on <i>Security</i> was not included in the <i>unique</i> constraint.&nbsp; To be quite honest I am not exactly sure why but I am guessing that the <i>AttributePropertyConvention </i>does not work with a reference.&nbsp; Instead I will need to add something to my <i>ReferenceConvention</i> which is provided by default with s#arp architecture.</p>
<div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:2787227c-6879-4cc5-8c9a-f06d171b4095" class="wlWriterEditableSmartContent" style="padding-bottom:0px;margin:0px;padding-left:0px;padding-right:0px;display:inline;float:none;padding-top:0px;">
<div style="border:#000080 1px solid;color:#000;font-family:&#39;Courier New&#39;, Courier, Monospace;font-size:10pt;">
<div style="background:#fff;max-height:300px;overflow:auto;"><ol style="background:#ffffff;margin:0;padding:0 0 0 5px;">
<li><span style="color:#0000ff;">public</span> <span style="color:#0000ff;">class</span> <span style="color:#2b91af;">ReferenceConvention</span> : <span style="color:#2b91af;">IReferenceConvention</span> {</li>
<li style="background:#f3f3f3;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">public</span> <span style="color:#0000ff;">void</span> Apply(FluentNHibernate.Conventions.Instances.<span style="color:#2b91af;">IManyToOneInstance</span> instance) {</li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;instance.Column(instance.Property.Name + <span style="color:#a31515;">&quot;Fk&quot;</span>);</li>
<li style="background:#f3f3f3;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">if</span> (<span style="color:#2b91af;">Attribute</span>.IsDefined(instance.Property, <span style="color:#0000ff;">typeof</span> (<span style="color:#2b91af;">DomainSignatureAttribute</span>)))</li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;instance.UniqueKey(<span style="color:#a31515;">&quot;DomainSignature&quot;</span>);</li>
<li style="background:#f3f3f3;">&nbsp;&nbsp;&nbsp;&nbsp;}</li>
<li>}</li>
</ol></div>
</div>
</div>
<p>I don&#39;t really like this as I don&#39;t think the attribute should be ignored, but it does at least change the above to <i>unique(PriceDate, CanadianPrice, SecurityFk).</i></p>
<p>There are obviously many other types of constraints we could use, you could create an attribute for defining indexing on certain properties like [Indexable(&quot;IndexName&quot;)] and create a convention like this:</p>
<div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:dc415913-baed-4310-ae51-951f5c4fcec1" class="wlWriterEditableSmartContent" style="padding-bottom:0px;margin:0px;padding-left:0px;padding-right:0px;display:inline;float:none;padding-top:0px;">
<div style="border:#000080 1px solid;color:#000;font-family:&#39;Courier New&#39;, Courier, Monospace;font-size:10pt;">
<div style="background:#fff;max-height:300px;overflow:auto;"><ol style="background:#ffffff;margin:0;padding:0 0 0 5px;">
<li><span style="color:#0000ff;">public</span> <span style="color:#0000ff;">class</span> <span style="color:#2b91af;">IndexableAttribute</span> : <span style="color:#2b91af;">Attribute</span> {</li>
<li style="background:#f3f3f3;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">private</span> <span style="color:#0000ff;">readonly</span> <span style="color:#0000ff;">string</span> _name;</li>
<li>&nbsp;</li>
<li style="background:#f3f3f3;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">public</span> IndexableAttribute(<span style="color:#0000ff;">string</span> name) { _name = name; }</li>
<li>&nbsp;</li>
<li style="background:#f3f3f3;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">public</span> <span style="color:#0000ff;">string</span> GetName() { <span style="color:#0000ff;">return</span> _name; }</li>
<li>}</li>
<li style="background:#f3f3f3;">&nbsp;</li>
<li><span style="color:#0000ff;">public</span> <span style="color:#0000ff;">class</span> <span style="color:#2b91af;">IndexableConvention</span> : <span style="color:#2b91af;">AttributePropertyConvention</span>&lt;<span style="color:#2b91af;">IndexableAttribute</span>&gt; {</li>
<li style="background:#f3f3f3;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">protected</span> <span style="color:#0000ff;">override</span> <span style="color:#0000ff;">void</span> Apply(<span style="color:#2b91af;">IndexableAttribute</span> attribute, <span style="color:#2b91af;">IPropertyInstance</span> instance) {</li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;instance.Index(attribute.GetName());</li>
<li style="background:#f3f3f3;">&nbsp;&nbsp;&nbsp;&nbsp;}</li>
<li>}</li>
</ol></div>
</div>
</div>
<p>Now I can create indicies by using the [Indexable(&quot;Name&quot;)] attribute.&nbsp; Properties with the same &quot;Name&quot; will be part of the same index constraint and indexed together.&nbsp;</p>
<p>I found it is actually a good idea to always index many-to-one relationships, something I briefly mentioned in a <a href="http://www.lucisferre.net/post.aspx?id=ef779300-206b-4582-a9d0-4275b328c8c9">previous post</a>.&nbsp; Now that I am using fluent nhibernate however I can&#39;t set the index property in the HBM files so I will need a convention for that.&nbsp; It also makes sense to set this indexing on all many-to-one relationships so there is a better way to do this that does not involve the use of an attribute, instead we implement IRefrenceConvention.&nbsp; S#arp architecture already includes this convention by default so we can just edit it:</p>
<div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:0bc6d7e9-4abf-4c45-b26d-85fa8e16fca0" class="wlWriterEditableSmartContent" style="padding-bottom:0px;margin:0px;padding-left:0px;padding-right:0px;display:inline;float:none;padding-top:0px;">
<div style="border:#000080 1px solid;color:#000;font-family:&#39;Courier New&#39;, Courier, Monospace;font-size:10pt;">
<div style="background:#fff;max-height:300px;overflow:auto;"><ol style="background:#ffffff;margin:0;padding:0 0 0 5px;">
<li><span style="color:#0000ff;">public</span> <span style="color:#0000ff;">class</span> <span style="color:#2b91af;">ReferenceConvention</span> : <span style="color:#2b91af;">IReferenceConvention</span> {</li>
<li style="background:#f3f3f3;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">public</span> <span style="color:#0000ff;">void</span> Apply(FluentNHibernate.Conventions.Instances.<span style="color:#2b91af;">IManyToOneInstance</span> instance) {</li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;instance.Column(instance.Property.Name + <span style="color:#a31515;">&quot;Fk&quot;</span>);</li>
<li style="background:#f3f3f3;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">if</span> (<span style="color:#2b91af;">Attribute</span>.IsDefined(instance.Property, <span style="color:#0000ff;">typeof</span> (<span style="color:#2b91af;">DomainSignatureAttribute</span>)))</li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;instance.UniqueKey(<span style="color:#a31515;">&quot;DomainSignature&quot;</span>);</li>
<li style="background:#f3f3f3;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff;">else</span> </li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;instance.Index(instance.Property.Name + <span style="color:#a31515;">&quot;Index&quot;</span>);</li>
<li style="background:#f3f3f3;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;}</li>
</ol></div>
</div>
</div>
<p>Notice the if.else, if we have already defined <i>UniqueKey</i> defining Index would be redundant as unique key&#39;s are already indexed.&nbsp; When defining indexes you will typically see something like like the following DDL output from SchemaExport:</p>
<div id="codeSnippetWrapper">
<pre id="codeSnippet" style="border-style:none;margin:0em;padding:0px;overflow:visible;text-align:left;line-height:12pt;background-color:#f4f4f4;width:100%;font-family:&#39;Courier New&#39;,courier,monospace;direction:ltr;color:black;font-size:8pt;"><span style="color:#0000ff;">create</span> <span style="color:#0000ff;">index</span> SecurityIndex <span style="color:#0000ff;">on</span> Prices (SecurityFk)</pre>
<br /></div>
<p>It is pretty easy to customize the behavior of the fluent nhibernate AutoPersistenceModel using conventions and I find it can be very useful to have this type of fine grained control over your database schema generation.</p></div>
            </div>
        
        </div>
    </div>
</div>


<div class="CommonContentBox">
    <div style="float: right;">
        
                <a href="../../login.aspx%3FReturnUrl=%252Fwikis%252Fhowtonh%252Fcustomizing-fluent-nhibernate-s-autopersistencemodel-conventions.aspx.html"><img src="../../Themes/hawaii/images/wiki/add-a-new-comment.gif" alt="" style="border-width:0px;" /></a>
            
    </div>
    <h3 class="CommonContentBoxHeader">Recent Comments</h3>
    <div class="CommonContentBoxContent">
        
                <div class="WikiCommentArea">
                    <div class="WikiCommentBubble">
                        <div class="WikiCommentBubbleRoundTop"><div class="r1"></div><div class="r2"></div><div class="r3"></div><div class="r4"></div></div>
                        <div class="WikiCommentContent">
                            <div class="WikiCommentHeaderIcon"><a href="../../members/BobTodd/default.aspx.html">
                                    <img src="../../utility/anonymous.gif" alt="" style="border-width:0px;max-height:32px;max-width:32px;" />
                                </a></div>
                            
                            <div class="WikiCommentHeader">
                                By: 
                                <a href="../../members/BobTodd/default.aspx.html">Alastair R. Todd</a>
                                Posted on 
                                02-10-2010 14:07
                                
                            </div>
                            <div style="clear: both;"></div>
                            
                            <div><p>Any idea how you would get some automapped Index creation on a JoinedSubClass?</p>
<p>IJoinedSubclassInstance does not contain an Index() method</p>
</div>

                            <div style="float: right; font-size: 80%;">
                                
                                
                            </div><div style="clear: both;"></div>
                        </div>
                        <div class="WikiCommentBubbleRoundBottom"><div class="r1"></div><div class="r2"></div><div class="r3"></div><div class="r4"></div></div>
                    </div>
                    <div class="WikiCommentArrow"><div class="r1"></div><div class="r2"></div><div class="r3"></div><div class="r4"></div><div class="r5"></div><div class="r6"></div><div class="r7"></div><div class="r8"></div><div class="r9"></div><div class="r10"></div></div>
                </div>     
            
                <div class="WikiCommentArea">
                    <div class="WikiCommentBubble">
                        <div class="WikiCommentBubbleRoundTop"><div class="r1"></div><div class="r2"></div><div class="r3"></div><div class="r4"></div></div>
                        <div class="WikiCommentContent">
                            <div class="WikiCommentHeaderIcon"><a href="../../members/chnicola/default.aspx.html">
                                    <img src="../../resized-image.ashx/__size/32x32/__key/CommunityServer.Components.Avatars/00.00.00.26.62/4TDB5C9OI7XU.png" alt="" style="border-width:0px;" />
                                </a></div>
                            
                            <div class="WikiCommentHeader">
                                By: 
                                <a href="../../members/chnicola/default.aspx.html">Chris Nicola</a>
                                Posted on 
                                12-25-2009 14:08
                                
                            </div>
                            <div style="clear: both;"></div>
                            
                            <div><p>Looks like there isn&#39;t support for that yet: <a &nbsp;target="_new" href="http://code.google.com/p/fluent-nhibernate/issues/detail?id=306">code.google.com/.../detail</a></p>
</div>

                            <div style="float: right; font-size: 80%;">
                                
                                
                            </div><div style="clear: both;"></div>
                        </div>
                        <div class="WikiCommentBubbleRoundBottom"><div class="r1"></div><div class="r2"></div><div class="r3"></div><div class="r4"></div></div>
                    </div>
                    <div class="WikiCommentArrow"><div class="r1"></div><div class="r2"></div><div class="r3"></div><div class="r4"></div><div class="r5"></div><div class="r6"></div><div class="r7"></div><div class="r8"></div><div class="r9"></div><div class="r10"></div></div>
                </div>     
            
                <div class="WikiCommentArea">
                    <div class="WikiCommentBubble">
                        <div class="WikiCommentBubbleRoundTop"><div class="r1"></div><div class="r2"></div><div class="r3"></div><div class="r4"></div></div>
                        <div class="WikiCommentContent">
                            <div class="WikiCommentHeaderIcon"><a href="../../members/chnicola/default.aspx.html">
                                    <img src="../../resized-image.ashx/__size/32x32/__key/CommunityServer.Components.Avatars/00.00.00.26.62/4TDB5C9OI7XU.png" alt="" style="border-width:0px;" />
                                </a></div>
                            
                            <div class="WikiCommentHeader">
                                By: 
                                <a href="../../members/chnicola/default.aspx.html">Chris Nicola</a>
                                Posted on 
                                12-25-2009 14:06
                                
                            </div>
                            <div style="clear: both;"></div>
                            
                            <div><p>No I hadn&#39;t seen that before, but thanks that looks useful. &nbsp;I&#39;m not sure if I can implement that in fluent&#39;s conventions though, but perhaps I can. &nbsp;Not that I am married to fluent, I will likely output the configuration to HBM&#39;s at some point.</p>
</div>

                            <div style="float: right; font-size: 80%;">
                                
                                
                            </div><div style="clear: both;"></div>
                        </div>
                        <div class="WikiCommentBubbleRoundBottom"><div class="r1"></div><div class="r2"></div><div class="r3"></div><div class="r4"></div></div>
                    </div>
                    <div class="WikiCommentArrow"><div class="r1"></div><div class="r2"></div><div class="r3"></div><div class="r4"></div><div class="r5"></div><div class="r6"></div><div class="r7"></div><div class="r8"></div><div class="r9"></div><div class="r10"></div></div>
                </div>     
            
                <div class="WikiCommentArea">
                    <div class="WikiCommentBubble">
                        <div class="WikiCommentBubbleRoundTop"><div class="r1"></div><div class="r2"></div><div class="r3"></div><div class="r4"></div></div>
                        <div class="WikiCommentContent">
                            <div class="WikiCommentHeaderIcon"><a href="../../members/fabiomaulo/default.aspx.html">
                                    <img src="../../resized-image.ashx/__size/32x32/__key/CommunityServer.Components.Avatars/00.00.00.21.02/4TA8XMWXSUMY.png" alt="" style="border-width:0px;" />
                                </a></div>
                            
                            <div class="WikiCommentHeader">
                                By: 
                                <a href="../../members/fabiomaulo/default.aspx.html">Fabio Maulo</a>
                                Posted on 
                                12-25-2009 1:43
                                <div id="ctl00_ctl00_bcr_bcr_ctl13_ctl04_WikiPageCommentRating" class="WikiRatingSmall" title="Rated: 1 Ratings - 1 Yes, 0 No" ><div><img id="ctl00_ctl00_bcr_bcr_ctl13_ctl04_WikiPageCommentRating_image" alt="" style="display:none;" /><span id="ctl00_ctl00_bcr_bcr_ctl13_ctl04_WikiPageCommentRating_percent" class="WikiRatingGoodSmall">100%</span> <span id="ctl00_ctl00_bcr_bcr_ctl13_ctl04_WikiPageCommentRating_percenttext">of people found this useful</span></div></div>
                            </div>
                            <div style="clear: both;"></div>
                            
                            <div><p>Do you know &lt;natural-id&gt; ?</p>
</div>

                            <div style="float: right; font-size: 80%;">
                                
                                
                            </div><div style="clear: both;"></div>
                        </div>
                        <div class="WikiCommentBubbleRoundBottom"><div class="r1"></div><div class="r2"></div><div class="r3"></div><div class="r4"></div></div>
                    </div>
                    <div class="WikiCommentArrow"><div class="r1"></div><div class="r2"></div><div class="r3"></div><div class="r4"></div><div class="r5"></div><div class="r6"></div><div class="r7"></div><div class="r8"></div><div class="r9"></div><div class="r10"></div></div>
                </div>     
            
                <a href="customizing-fluent-nhibernate-s-autopersistencemodel-conventions/comments.aspx.html">View All</a>
            
    </div>
</div>


</div></div>
			    <div style="clear: both;"></div>
			    
			    
            </div>
                
            <div id="CommonFooter">
                <div class="Common">
                    
                        
                	    
                        

                        
                                <a href="http://communityserver.com/" target="_blank"><img src="../../utility/PoweredByCS_commercial.gif" alt="Powered by Community Server (Commercial Edition), by Telligent Systems " style="border-width:0px;" /></a>
		                    
                		
                    
                 </div>
            </div>
		
<script type="text/javascript">
// <![CDATA[
Telligent_Modal.Configure('/utility/loading.htm',['CommonModal'],['CommonModalTitle'],['CommonModalClose'],['CommonModalContent'],['CommonModalFooter'],['CommonModalResize'],['CommonModalMask'],100,false,true);
// ]]>
</script><script type="text/javascript">
<!--
function KeyDownHandlerctl00_ctl00_sr_sr_ctl00_ctl00_TitleBarSearchButton(event)
{
	if (event.keyCode == 13)
	{
		event.returnValue = false;
		event.cancel = true;
     __doPostBack('ctl00$ctl00$sr$sr$ctl00$ctl00$TitleBarSearchButton','')
   return false;
	}
}

//-->
</script>
<script type="text/javascript">
// <![CDATA[
window.ctl00_ctl00_rcr_rcr_ctl00_ctl02_ctl00_ctl01_ctl01=new WikiPageHierarchy('ctl00_ctl00_rcr_rcr_ctl00_ctl02_ctl00_ctl01_ctl01',new Function('mode','pageId','callback','WebForm_DoCallback(\'ctl00$ctl00$rcr$rcr$ctl00$ctl02$ctl00$ctl01$ctl01\',mode + \':\' + pageId,callback,\"\",null,false)'),'<img src="http://nhforge.org/wikis/howtonh/\&quot;/WebResource.axd?d=sNXLzaCqbYO_a-ZjCZB88HF4WT8YRbuRaD2xfyafsCiRqelSVt4GYH9QzNn_EvXM02V5zpjGwsymzmW30OIrbB4EUeqA1XW4oU6sME2qMEcOgSVpfz1_YK7UdKB8bVtbFiuWJt3UljrDk5OnRzQEWKDyXNGX0R6sJsultQeBjufuUDz-0&amp;t=634395149500000000\&quot;" alt=\"+\" style=\"border-width: 0;\" />','<img src="http://nhforge.org/wikis/howtonh/\&quot;/WebResource.axd?d=I7Z2L5Ca7ffItUeObf-LA3ykZ3Mbmr-vwfNJv2PfNk2O4alHWIJbJADyKhl0k71mJCpGTePjifKqZQx_Rs64LrGhlEU25qRjlCh8LoYwo2tck8EIbBdQKg5CISopk9hz_6ZbK_GNtBJljwOq57_FBvxYCTM1&amp;t=634395149500000000\&quot;" alt=\"-\" style=\"border-width: 0;\" />','<div>Loading...</div>');
// ]]>
</script><script type="text/javascript">
// <![CDATA[
window.ctl00_ctl00_rcr_rcr_ctl00_ctl03_ctl00_ctl01_ctl01=new WikiPageHierarchy('ctl00_ctl00_rcr_rcr_ctl00_ctl03_ctl00_ctl01_ctl01',new Function('mode','pageId','callback','WebForm_DoCallback(\'ctl00$ctl00$rcr$rcr$ctl00$ctl03$ctl00$ctl01$ctl01\',mode + \':\' + pageId,callback,\"\",null,false)'),'<img src="http://nhforge.org/wikis/howtonh/\&quot;/WebResource.axd?d=sNXLzaCqbYO_a-ZjCZB88HF4WT8YRbuRaD2xfyafsCiRqelSVt4GYH9QzNn_EvXM02V5zpjGwsymzmW30OIrbB4EUeqA1XW4oU6sME2qMEcOgSVpfz1_YK7UdKB8bVtbFiuWJt3UljrDk5OnRzQEWKDyXNGX0R6sJsultQeBjufuUDz-0&amp;t=634395149500000000\&quot;" alt=\"+\" style=\"border-width: 0;\" />','<img src="http://nhforge.org/wikis/howtonh/\&quot;/WebResource.axd?d=I7Z2L5Ca7ffItUeObf-LA3ykZ3Mbmr-vwfNJv2PfNk2O4alHWIJbJADyKhl0k71mJCpGTePjifKqZQx_Rs64LrGhlEU25qRjlCh8LoYwo2tck8EIbBdQKg5CISopk9hz_6ZbK_GNtBJljwOq57_FBvxYCTM1&amp;t=634395149500000000\&quot;" alt=\"-\" style=\"border-width: 0;\" />','<div>Loading...</div>');
// ]]>
</script><script type="text/javascript">
// <![CDATA[
window.ctl00_ctl00_bcr_bcr_ctl09_ctl01 = new Telligent_InlineEditorPanel('ctl00_ctl00_bcr_bcr_ctl09_ctl01','ctl00_ctl00_bcr_bcr_ctl09_ctl01','ctl00_ctl00_bcr_bcr_ctl09_ctl01_State','ctl00_ctl00_bcr_bcr_ctl09_ctl00',false,null,null,null);
// ]]>
</script><script type="text/javascript">
// <![CDATA[
var ctl00_ctl00_bcr_bcr_ctl13_ctl04_WikiPageCommentRating = new RateableContentYesNoRating('ctl00_ctl00_bcr_bcr_ctl13_ctl04_WikiPageCommentRating','ctl00_ctl00_bcr_bcr_ctl13_ctl04_WikiPageCommentRating','ctl00_ctl00_bcr_bcr_ctl13_ctl04_WikiPageCommentRating_image','ctl00_ctl00_bcr_bcr_ctl13_ctl04_WikiPageCommentRating_percent','ctl00_ctl00_bcr_bcr_ctl13_ctl04_WikiPageCommentRating_percenttext','ctl00_ctl00_bcr_bcr_ctl13_ctl04_WikiPageCommentRating_buttons','ctl00_ctl00_bcr_bcr_ctl13_ctl04_WikiPageCommentRating_thanks','WikiRatingSmall','WikiRatingActiveSmall',new Function('r','s','f','WebForm_DoCallback(\'ctl00$ctl00$bcr$bcr$ctl13$ctl04$WikiPageCommentRating\',r,s,r,f,false)'));
// ]]>
</script><script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-5443308-1");
pageTracker._trackPageview();
</script></form>
		
	</body>
</html>
