---
layout: post
title: "NHibernate 2.1.0: HQL With clause"
date: 2009-05-17 19:56:00 +1200
comments: true
published: true
categories: ["blogs", "nhibernate", "archive"]
tags: ["NHibernate", "NH2.1", "HQL"]
redirect_from: ["/blogs/nhibernate/archive/2009/05/17/nhibernate-2-1-0-hql-with-clause.aspx/"]
author: fabiomaulo
gravatar: cd6db202ce94ed7e5f1fde30e702dc7f
---
{% include imported_disclaimer.html %}
<p>[<a href="http://fabiomaulo.blogspot.com/" target="_blank">My blog</a>]</p>
<p>A simple SQL:</p>
<p><span style="color: #800080">SELECT * FROM Animal AS a1 </span></p>
<p><span style="color: #800080">INNER JOIN Animal AS a2 on a1.mother_id = a2.ID and a1.body_weight &lt; :aLimit</span></p>
<p>Another:</p>
<p><span style="color: #800080">SELECT * FROM Animal AS a1 INNER JOIN Animal AS a2 on a1.mother_id = a2.ID </span></p>
<p><span style="color: #800080">WHERE a1.body_weight &lt; :aLimit</span></p>
<p>Which is the difference in term of results ? There isn&rsquo;t.</p>
<p>Some DB engine don&rsquo;t make difference, between the two SQLs, even in term of execution plan but&hellip; you know, there are some RDBMS not so smart (guess which one [:#]&nbsp;).</p>
<p>With the new HQL parser, based on ANTLR, we are supporting a new clause named &ldquo;with&rdquo;.</p>
<p>The HQL:</p>
<p><span style="color: #800000">from Animal a inner join a.mother as m <strong><span style="color: #800000">with</span></strong> m.bodyWeight &lt; :someLimit</span></p>
<p>The result SQL using <a href="http://fabiomaulo.blogspot.com/2009/05/oh-beautiful-sql.html">this mapping</a> :</p>
<p><span style="color: #800080">select      <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal0_.id as id14_0_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal1_.id as id14_1_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal0_.description as descript2_14_0_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal0_.body_weight as body3_14_0_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal0_.mother_id as mother4_14_0_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal0_.father_id as father5_14_0_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal0_.zoo_id as zoo6_14_0_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal0_.serialNumber as serialNu7_14_0_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal0_1_.bodyTemperature as bodyTemp2_15_0_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal0_3_.pregnant as pregnant17_0_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal0_3_.birthdate as birthdate17_0_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal0_4_.owner as owner18_0_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal0_7_.name_first as name2_21_0_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal0_7_.name_initial as name3_21_0_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal0_7_.name_last as name4_21_0_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal0_7_.nickName as nickName21_0_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal0_7_.height as height21_0_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal0_7_.intValue as intValue21_0_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal0_7_.floatValue as floatValue21_0_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal0_7_.bigDecimalValue as bigDecim9_21_0_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal0_7_.bigIntegerValue as bigInte10_21_0_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; when animal0_2_.reptile is not null then 2       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; when animal0_5_.mammal is not null then 5       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; when animal0_6_.mammal is not null then 6       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; when animal0_4_.mammal is not null then 4       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; when animal0_7_.mammal is not null then 7       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; when animal0_1_.animal is not null then 1       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; when animal0_3_.animal is not null then 3       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; when animal0_.id is not null then 0       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end as clazz_0_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal1_.description as descript2_14_1_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal1_.body_weight as body3_14_1_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal1_.mother_id as mother4_14_1_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal1_.father_id as father5_14_1_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal1_.zoo_id as zoo6_14_1_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal1_.serialNumber as serialNu7_14_1_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal1_1_.bodyTemperature as bodyTemp2_15_1_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal1_3_.pregnant as pregnant17_1_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal1_3_.birthdate as birthdate17_1_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal1_4_.owner as owner18_1_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal1_7_.name_first as name2_21_1_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal1_7_.name_initial as name3_21_1_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal1_7_.name_last as name4_21_1_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal1_7_.nickName as nickName21_1_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal1_7_.height as height21_1_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal1_7_.intValue as intValue21_1_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal1_7_.floatValue as floatValue21_1_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal1_7_.bigDecimalValue as bigDecim9_21_1_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal1_7_.bigIntegerValue as bigInte10_21_1_,       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; when animal1_2_.reptile is not null then 2       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; when animal1_5_.mammal is not null then 5       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; when animal1_6_.mammal is not null then 6       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; when animal1_4_.mammal is not null then 4       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; when animal1_7_.mammal is not null then 7       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; when animal1_1_.animal is not null then 1       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; when animal1_3_.animal is not null then 3       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; when animal1_.id is not null then 0       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end as clazz_1_       <br />&nbsp;&nbsp;&nbsp; from       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Animal animal0_       <br />&nbsp;&nbsp;&nbsp; left outer join       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Reptile animal0_1_       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; on animal0_.id=animal0_1_.animal       <br />&nbsp;&nbsp;&nbsp; left outer join       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Lizard animal0_2_       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; on animal0_.id=animal0_2_.reptile       <br />&nbsp;&nbsp;&nbsp; left outer join       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Mammal animal0_3_       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; on animal0_.id=animal0_3_.animal       <br />&nbsp;&nbsp;&nbsp; left outer join       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DomesticAnimal animal0_4_       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; on animal0_.id=animal0_4_.mammal       <br />&nbsp;&nbsp;&nbsp; left outer join       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Cat animal0_5_       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; on animal0_.id=animal0_5_.mammal       <br />&nbsp;&nbsp;&nbsp; left outer join       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dog animal0_6_       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; on animal0_.id=animal0_6_.mammal       <br />&nbsp;&nbsp;&nbsp; left outer join       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Human animal0_7_       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; on animal0_.id=animal0_7_.mammal       <br />&nbsp;&nbsp;&nbsp; inner join       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Animal animal1_       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; on animal0_.mother_id=animal1_.id       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; and (       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal1_.body_weight&lt;@p0       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )       <br />&nbsp;&nbsp;&nbsp; left outer join       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Reptile animal1_1_       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; on animal1_.id=animal1_1_.animal       <br />&nbsp;&nbsp;&nbsp; left outer join       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Lizard animal1_2_       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; on animal1_.id=animal1_2_.reptile       <br />&nbsp;&nbsp;&nbsp; left outer join       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Mammal animal1_3_       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; on animal1_.id=animal1_3_.animal       <br />&nbsp;&nbsp;&nbsp; left outer join       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DomesticAnimal animal1_4_       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; on animal1_.id=animal1_4_.mammal       <br />&nbsp;&nbsp;&nbsp; left outer join       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Cat animal1_5_       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; on animal1_.id=animal1_5_.mammal       <br />&nbsp;&nbsp;&nbsp; left outer join       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Dog animal1_6_       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; on animal1_.id=animal1_6_.mammal       <br />&nbsp;&nbsp;&nbsp; left outer join       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Human animal1_7_       <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; on animal1_.id=animal1_7_.mammal;       <br />&nbsp;&nbsp;&nbsp; @p0 = 1</span></p>
<p>First&hellip; easy HQL with complex mapping mean complex SQL but&hellip; not a big pain for NH&rsquo;s users [;)]</p>
<p>Note this:</p>
<p><strong><span style="color: #800080">inner join        <br />&nbsp;&nbsp;&nbsp; Animal animal1_         <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; on animal0_.mother_id=animal1_.id         <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; and (         <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; animal1_.body_weight&lt;@p0         <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )</span> </strong></p>
<p>stock_stack&hellip;&hellip;stumb&hellip;sfrfrfrfrfrfr (biglia, sponda e filotto).</p>
